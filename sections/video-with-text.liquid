<div class="relative py-16 md:py-24 px-4 overflow-hidden video-with-text" style="min-height: 600px;">
    <!-- Video de fondo -->
    <div class="absolute inset-0 w-full h-full overflow-hidden z-0">
        {% if section.settings.video_file != blank %}
            <video 
                class="absolute top-0 left-0 w-full h-full object-cover"
                autoplay
                muted
                loop
                playsinline
                preload="auto"
                id="background-video"
                webkit-playsinline
                x-webkit-airplay="allow"
                {% if section.settings.video_poster %}poster="{{ section.settings.video_poster | image_url: width: 1920 }}"{% endif %}
                style="width: 100%; height: 100%; object-fit: cover; z-index: 1;"
                onloadedmetadata="this.muted = true; this.play();">
                <source src="{{ section.settings.video_file }}" type="video/mp4">
                Tu navegador no soporta video HTML5.
            </video>
        {% elsif section.settings.video_url != blank %}
            {% assign video_url = section.settings.video_url %}
            {% if video_url contains 'youtube.com' or video_url contains 'youtu.be' %}
                {% if video_url contains 'watch?v=' %}
                    {% assign video_id = video_url | split: 'watch?v=' | last | split: '&' | first %}
                {% elsif video_url contains 'youtu.be/' %}
                    {% assign video_id = video_url | split: 'youtu.be/' | last | split: '?' | first %}
                {% else %}
                    {% assign video_id = video_url | split: 'embed/' | last | split: '?' | first %}
                {% endif %}
                <iframe 
                    class="absolute top-0 left-0 w-full h-full"
                    src="https://www.youtube.com/embed/{{ video_id }}?autoplay=1&mute=1&loop=1&controls=0&playlist={{ video_id }}&playsinline=1"
                    frameborder="0"
                    allow="autoplay; encrypted-media; fullscreen"
                    allowfullscreen
                    style="pointer-events: none; width: 100%; height: 100%; z-index: 1;">
                </iframe>
            {% elsif video_url contains 'vimeo.com' %}
                {% assign video_id = video_url | split: 'vimeo.com/' | last | split: '/' | first %}
                <iframe 
                    class="absolute top-0 left-0 w-full h-full"
                    src="https://player.vimeo.com/video/{{ video_id }}?autoplay=1&muted=1&loop=1&background=1&controls=0"
                    frameborder="0"
                    allow="autoplay; fullscreen; picture-in-picture"
                    allowfullscreen
                    style="pointer-events: none; width: 100%; height: 100%; z-index: 1;">
                </iframe>
            {% endif %}
        {% else %}
            <div class="absolute top-0 left-0 w-full h-full bg-gray-900"></div>
        {% endif %}
        
        <!-- Overlay oscuro para mejorar legibilidad del texto -->
        <div class="absolute inset-0 bg-black bg-opacity-40" style="z-index: 2;"></div>
    </div>

    <!-- Contenido sobre el video -->
    <div class="max-w-7xl mx-auto relative" style="z-index: 10;">
        <div class="p-4 md:p-8 lg:p-12">
            
            <!-- Header con título y descripción -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 md:gap-8 mb-6 md:mb-8">
                <div>
                    <h2 class="text-2xl md:text-3xl lg:text-4xl font-bold text-white drop-shadow-lg">{{ section.settings.title }}</h2>
                </div>
                <div class="flex items-center">
                    <p class="text-white text-sm md:text-base leading-relaxed drop-shadow-md">{{ section.settings.description }}</p>
                </div>
            </div>

            <!-- Título inferior grande -->
            <div class="mt-12 md:mt-16">
                <h3 class="text-3xl md:text-5xl lg:text-6xl font-bold text-white drop-shadow-lg">{{ section.settings.bottom_title }}</h3>
            </div>

        </div>
    </div>
</div>

<script>
// Debug y autoplay del video
(function() {
    console.log('=== VIDEO DEBUG START ===');
    console.log('Video file setting:', '{{ section.settings.video_file }}');
    console.log('Video URL setting:', '{{ section.settings.video_url }}');
    
    function forceVideoPlay() {
        const videoElement = document.querySelector('#background-video');
        const iframeElement = document.querySelector('.video-with-text iframe');
        
        console.log('Video element found:', !!videoElement);
        console.log('Iframe element found:', !!iframeElement);
        
        if (videoElement) {
            const source = videoElement.querySelector('source');
            console.log('Video source:', source ? source.src : 'No source');
            
            // Forzar mute y play múltiples veces
            videoElement.muted = true;
            videoElement.volume = 0;
            videoElement.defaultMuted = true;
            
            videoElement.addEventListener('loadeddata', function() {
                console.log('✅ Video loaded successfully');
                videoElement.muted = true;
                videoElement.play().then(function() {
                    console.log('✅ Video playing after loadeddata');
                }).catch(function(error) {
                    console.error('❌ Play failed after loadeddata:', error);
                });
            });
            
            videoElement.addEventListener('canplay', function() {
                console.log('Video can play');
                videoElement.muted = true;
                videoElement.play().catch(function(error) {
                    console.error('❌ Play failed on canplay:', error);
                });
            });
            
            videoElement.addEventListener('error', function(e) {
                console.error('❌ Error loading video:', e);
                console.error('Video element state:', {
                    networkState: videoElement.networkState,
                    readyState: videoElement.readyState,
                    error: videoElement.error
                });
            });
            
            // Intentar reproducir inmediatamente
            videoElement.play().then(function() {
                console.log('✅ Video playing immediately');
            }).catch(function(error) {
                console.error('❌ Immediate play prevented:', error);
                
                // Si falla, intentar después de un pequeño delay
                setTimeout(function() {
                    videoElement.muted = true;
                    videoElement.play().then(function() {
                        console.log('✅ Video playing after delay');
                    }).catch(function(err) {
                        console.error('❌ Delayed play failed:', err);
                    });
                }, 100);
            });
            
            // Forzar reproducción en interacción del usuario
            document.addEventListener('click', function playOnClick() {
                videoElement.muted = true;
                videoElement.play().then(function() {
                    console.log('✅ Video playing after user interaction');
                    document.removeEventListener('click', playOnClick);
                }).catch(function(error) {
                    console.error('❌ Play on click failed:', error);
                });
            }, { once: true });
        }
        
        if (iframeElement) {
            console.log('Iframe src:', iframeElement.src);
        }
        
        if (!videoElement && !iframeElement) {
            console.warn('⚠️ No video or iframe element found. Check settings.');
        }
    }
    
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', forceVideoPlay);
    } else {
        forceVideoPlay();
    }
    
    console.log('=== VIDEO DEBUG END ===');
})();
</script>

{% schema %}
{
    "name": "Video with Text",
    "settings": [
        {
            "type": "text",
            "id": "title",
            "default": "Joyería Atemporal De Oro9k",
            "label": "Título principal"
        },
        {
            "type": "textarea",
            "id": "description",
            "default": "Creemos en el lujo sutil: pizzas simples, elegantes, y diseñadas para brillar junto con tu belleza interior. Nuestro oro de 9k es duradero, ético y perfecto para el uso diario.",
            "label": "Descripción"
        },
        {
            "type": "text",
            "id": "video_url",
            "label": "URL del video (YouTube o Vimeo)",
            "info": "Ejemplo: https://www.youtube.com/embed/VIDEO_ID"
        },
        {
            "type": "text",
            "id": "video_file",
            "label": "URL del archivo de video (MP4)",
            "info": "1. Ve a Settings > Files en tu admin de Shopify. 2. Sube tu video .mp4. 3. Haz clic en el archivo subido para abrir. 4. Copia la URL que aparece en la barra de direcciones. 5. Pega esa URL aquí."
        },
        {
            "type": "image_picker",
            "id": "video_poster",
            "label": "Imagen de portada del video"
        },
        {
            "type": "text",
            "id": "bottom_title",
            "default": "Lujo Discreto Y De Calidad",
            "label": "Título inferior"
        }
    ],
    "presets": [
        {
            "name": "Video with Text"
        }
    ]
}
{% endschema %}
