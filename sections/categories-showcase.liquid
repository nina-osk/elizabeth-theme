<div class="w-full bg-white">
  <div class="mx-auto max-w-7xl px-6 md:px-12 lg:px-20 py-16 md:py-20">
    <!-- Header -->
    <div class="text-center mb-12 md:mb-16">
      <h2 class="text-3xl md:text-4xl lg:text-5xl font-bold text-black mb-3 leading-tight">
        {{ section.settings.title }}
      </h2>
      <p class="text-gray-500 text-sm md:text-base">
        {{ section.settings.subtitle }}
      </p>
    </div>

    <!-- 3D Carousel Container -->
    <div class="flex justify-center items-center mb-12 md:mb-16" style="perspective: 1200px; height: 520px;">
      <div class="carousel-container relative w-full h-full flex items-center justify-center" style="transform-style: preserve-3d;">

        {% assign cards = (1..5) %}
        {% for i in cards %}
          {% assign prod_key = 'category_' | append: i | append: '_product' %}
          {% assign label_key = 'category_' | append: i | append: '_label' %}
          {% assign prod = section.settings[prod_key] %}
          <div class="carousel-item absolute w-36 md:w-44 lg:w-52 h-52 md:h-64 lg:h-72 rounded-lg cursor-pointer transition-all duration-700 overflow-hidden shadow-lg bg-white" data-index="{{ forloop.index0 }}" style="transform-style: preserve-3d;">
            <div class="w-full h-full flex flex-col">
              {% if prod != blank and prod.featured_media %}
                <div class="h-3/4 w-full overflow-hidden bg-gray-100">
                  {{ prod.featured_media | image_url: width: 600 | image_tag: alt: prod.title, class: 'w-full h-full object-cover', loading: 'lazy', width: 600, height: 600 }}
                </div>
                <div class="h-1/4 w-full px-3 py-2 flex flex-col justify-center">
                  <p class="text-xs text-gray-500 truncate">{{ prod.vendor }}</p>
                  <p class="text-sm font-semibold text-gray-800 truncate">{{ prod.title }}</p>
                  <p class="text-sm text-gray-600">{{ prod.price | money }}</p>
                </div>
              {% else %}
                <div class="h-full w-full flex items-center justify-center bg-stone-100 text-center px-4">
                  <span class="text-sm font-medium text-gray-600">
                    {{ section.settings[label_key] | default: 'Producto' }}
                  </span>
                </div>
              {% endif %}
            </div>
          </div>
        {% endfor %}


      </div>
    </div>
    <!-- Controls -->
    <div class="flex justify-center gap-4 md:gap-6">
      <button id="zoom-in-btn" class="flex items-center gap-2 px-5 md:px-6 py-2 md:py-3 border-2 border-black text-black text-xs md:text-sm font-semibold uppercase hover:bg-black hover:text-white transition-colors">
        üîç Zoom
      </button>
      <button id="rotate-btn" class="flex items-center gap-2 px-5 md:px-6 py-2 md:py-3 border-2 border-black text-black text-xs md:text-sm font-semibold uppercase hover:bg-black hover:text-white transition-colors">
        ‚Üª Rotar
      </button>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const items = document.querySelectorAll('.carousel-item');
    const zoomBtn = document.getElementById('zoom-in-btn');
    const rotateBtn = document.getElementById('rotate-btn');

    const itemCount = items.length;
    const radius = 420;
    let currentRotation = 0;
    let currentZoom = 1;
    let rotateY = 0;

    function updateCarousel() {
      items.forEach((item, index) => {
        const angle = (360 / itemCount) * index + currentRotation;
        const radians = (angle * Math.PI) / 180;
        const x = Math.cos(radians) * radius;
        const z = Math.sin(radians) * radius;
        const zNormalized = (z + radius) / (radius * 2);
        const scale = 0.65 + zNormalized * 0.35;
        const opacity = 0.45 + zNormalized * 0.55;

        item.style.transform = `translateX(${x}px) translateZ(${z}px) scale(${scale})`;
        item.style.opacity = opacity;
        item.style.zIndex = Math.round(z);
      });
    }

    function rotateToItem(index) {
      const targetRotation = -(360 / itemCount) * index;
      currentRotation = targetRotation;
      updateCarousel();
    }

    items.forEach((item, index) => {
      item.addEventListener('click', () => rotateToItem(index));
    });

    if (zoomBtn) {
      zoomBtn.addEventListener('click', () => {
        currentZoom = currentZoom === 1 ? 1.15 : 1;
        items.forEach((item) => {
          item.style.transform += ` scale(${currentZoom})`;
        });
      });
    }

    if (rotateBtn) {
      rotateBtn.addEventListener('click', () => {
        rotateY = (rotateY + 45) % 360;
        items.forEach((item) => {
          item.style.transform += ` rotateY(${rotateY}deg)`;
        });
      });
    }

    rotateToItem(2);
  });
</script>

{% schema %}
{
  "name": "Categories Showcase",
  "settings": [
    { "type": "text", "id": "title", "label": "T√≠tulo", "default": "Dise√±os Unicos Y Elegantes Para Tu D√≠a AD√≠a" },
    { "type": "text", "id": "subtitle", "label": "Subt√≠tulo", "default": "Soon-to-be staples in your rotation" },

    { "type": "text", "id": "category_1_label", "label": "Categor√≠a 1 - Texto fallback", "default": "Earring" },
    { "type": "product", "id": "category_1_product", "label": "Categor√≠a 1 - Producto" },

    { "type": "text", "id": "category_2_label", "label": "Categor√≠a 2 - Texto fallback", "default": "Bracelet" },
    { "type": "product", "id": "category_2_product", "label": "Categor√≠a 2 - Producto" },

    { "type": "text", "id": "category_3_label", "label": "Categor√≠a 3 - Texto fallback", "default": "Necklace" },
    { "type": "product", "id": "category_3_product", "label": "Categor√≠a 3 - Producto" },

    { "type": "text", "id": "category_4_label", "label": "Categor√≠a 4 - Texto fallback", "default": "Earring" },
    { "type": "product", "id": "category_4_product", "label": "Categor√≠a 4 - Producto" },

    { "type": "text", "id": "category_5_label", "label": "Categor√≠a 5 - Texto fallback", "default": "Accessories" },
    { "type": "product", "id": "category_5_product", "label": "Categor√≠a 5 - Producto" }
  ],
  "presets": [
    { "name": "Categories Showcase" }
  ]
}
{% endschema %}
