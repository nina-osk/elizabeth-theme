<div class="w-full bg-white">
  <div class="mx-auto max-w-7xl px-4 md:px-6 lg:px-20 py-12 md:py-16 lg:py-20">
    <!-- Header -->
    <div class="text-center mb-8 md:mb-12 lg:mb-16">
      <h2 class="text-2xl md:text-3xl lg:text-5xl font-bold text-black mb-2 md:mb-3 leading-tight">
        {{ section.settings.title }}
      </h2>
      <p class="text-gray-500 text-xs md:text-sm lg:text-base">
        {{ section.settings.subtitle }}
      </p>
    </div>

    <!-- Mobile View (Carrusel rotativo) -->
    <div class="md:hidden mb-8 px-4">
      <div class="relative w-full overflow-visible" style="height: 400px;">
        <div class="mobile-carousel-container relative flex items-center justify-center" style="height: 100%;">
          {% assign cards = (1..5) %}
          {% for i in cards %}
            {% assign prod_key = 'category_' | append: i | append: '_product' %}
            {% assign label_key = 'category_' | append: i | append: '_label' %}
            {% assign prod = section.settings[prod_key] %}
            
            <div class="mobile-carousel-item absolute border-2 border-black rounded-lg cursor-pointer transition-all duration-500 overflow-hidden shadow-xl bg-white" 
                 data-index="{{ forloop.index0 }}" 
                 style="width: 200px; height: 280px; top: 50%; left: 50%; transform: translate(-50%, -50%);">
              <div class="w-full h-full flex flex-col">
                {% if prod != blank and prod.featured_media %}
                  <div class="h-2/3 w-full overflow-hidden bg-gray-100">
                    {{ prod.featured_media | image_url: width: 400 | image_tag: alt: prod.title, class: 'w-full h-full object-cover', loading: 'lazy', width: 400, height: 400 }}
                  </div>
                  <div class="h-1/3 w-full px-3 py-2 flex flex-col justify-center border-t border-gray-200 bg-white">
                    <p class="text-xs text-gray-500 truncate">{{ prod.vendor }}</p>
                    <p class="text-sm font-semibold text-gray-800 truncate">{{ prod.title }}</p>
                    <p class="text-sm font-bold text-black">{{ prod.price | money }}</p>
                  </div>
                {% else %}
                  <div class="h-full w-full flex items-center justify-center bg-stone-100 text-center px-2">
                    <span class="text-xs font-medium text-gray-600">
                      {{ section.settings[label_key] | default: 'Producto' }}
                    </span>
                  </div>
                {% endif %}
              </div>
            </div>
          {% endfor %}
        </div>
      </div>
    </div>

    <!-- Mobile Controls -->
    <div class="md:hidden flex justify-center gap-2 mb-8">
      <button id="mobile-prev-btn" class="px-3 py-1 border-2 border-black text-black text-xs font-semibold uppercase hover:bg-black hover:text-white transition-colors rounded">
        ‚Üê Anterior
      </button>
      <button id="mobile-next-btn" class="px-3 py-1 border-2 border-black text-black text-xs font-semibold uppercase hover:bg-black hover:text-white transition-colors rounded">
        Siguiente ‚Üí
      </button>
    </div>

    <!-- Desktop View (3D Carousel) -->
    <div class="hidden md:flex justify-center items-center mb-12" style="perspective: 1200px; height: 520px;">
      <div class="carousel-container relative w-full h-full flex items-center justify-center" style="transform-style: preserve-3d;">

        {% assign cards = (1..5) %}
        {% for i in cards %}
          {% assign prod_key = 'category_' | append: i | append: '_product' %}
          {% assign label_key = 'category_' | append: i | append: '_label' %}
          {% assign prod = section.settings[prod_key] %}
          
          <div class="carousel-item absolute w-36 md:w-44 lg:w-52 h-52 md:h-64 lg:h-72 border-2 border-black rounded-lg cursor-pointer transition-all duration-700 overflow-hidden shadow-lg bg-white" data-index="{{ forloop.index0 }}" style="transform-style: preserve-3d;">
            <div class="w-full h-full flex flex-col">
              {% if prod != blank and prod.featured_media %}
                <div class="h-3/4 w-full overflow-hidden bg-gray-100">
                  {{ prod.featured_media | image_url: width: 600 | image_tag: alt: prod.title, class: 'w-full h-full object-cover', loading: 'lazy', width: 600, height: 600 }}
                </div>
                <div class="h-1/4 w-full px-3 py-2 flex flex-col justify-center border-t border-gray-200">
                  <p class="text-xs text-gray-500 truncate">{{ prod.vendor }}</p>
                  <p class="text-sm font-semibold text-gray-800 truncate">{{ prod.title }}</p>
                  <p class="text-sm font-bold text-black">{{ prod.price | money }}</p>
                </div>
              {% else %}
                <div class="h-full w-full flex items-center justify-center bg-stone-100 text-center px-4">
                  <span class="text-sm font-medium text-gray-600">
                    {{ section.settings[label_key] | default: 'Producto' }}
                  </span>
                </div>
              {% endif %}
            </div>
          </div>
        {% endfor %}

      </div>
    </div>

    <!-- Desktop Controls -->
    <div class="hidden md:flex justify-center gap-4 lg:gap-6">
      <button id="zoom-in-btn" class="flex items-center gap-2 px-5 lg:px-6 py-2 lg:py-3 border-2 border-black text-black text-xs lg:text-sm font-semibold uppercase hover:bg-black hover:text-white transition-colors">
        üîç Zoom
      </button>
      <button id="rotate-btn" class="flex items-center gap-2 px-5 lg:px-6 py-2 lg:py-3 border-2 border-black text-black text-xs lg:text-sm font-semibold uppercase hover:bg-black hover:text-white transition-colors">
        ‚Üª Rotar
      </button>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Mobile Carousel
    const mobileContainer = document.querySelector('.mobile-carousel-container');
    const mobileItems = document.querySelectorAll('.mobile-carousel-item');
    const mobilePrevBtn = document.getElementById('mobile-prev-btn');
    const mobileNextBtn = document.getElementById('mobile-next-btn');

    if (mobileItems.length > 0) {
      let mobileCurrentIndex = 0;

      function updateMobileCarousel() {
        mobileItems.forEach((item, index) => {
          const diff = index - mobileCurrentIndex;
          
          if (diff === 0) {
            // Tarjeta principal (al frente, centrada)
            item.style.transform = 'translate(-50%, -50%) scale(1) rotate(0deg)';
            item.style.opacity = '1';
            item.style.zIndex = '30';
            item.style.top = '50%';
            item.style.left = '50%';
          } else if (diff === 1 || (mobileCurrentIndex === mobileItems.length - 1 && index === 0)) {
            // Segunda tarjeta (detr√°s a la derecha)
            item.style.transform = 'translate(-40%, -55%) scale(0.9) rotate(3deg)';
            item.style.opacity = '0.85';
            item.style.zIndex = '20';
            item.style.top = '50%';
            item.style.left = '50%';
          } else if (diff === 2 || (mobileCurrentIndex >= mobileItems.length - 2 && index < 2)) {
            // Tercera tarjeta (m√°s atr√°s a la derecha)
            item.style.transform = 'translate(-30%, -60%) scale(0.8) rotate(5deg)';
            item.style.opacity = '0.6';
            item.style.zIndex = '10';
            item.style.top = '50%';
            item.style.left = '50%';
          } else if (diff === -1 || (mobileCurrentIndex === 0 && index === mobileItems.length - 1)) {
            // Tarjeta anterior (detr√°s a la izquierda)
            item.style.transform = 'translate(-60%, -55%) scale(0.9) rotate(-3deg)';
            item.style.opacity = '0.85';
            item.style.zIndex = '20';
            item.style.top = '50%';
            item.style.left = '50%';
          } else {
            // Tarjetas ocultas
            item.style.transform = 'translate(-50%, -50%) scale(0.7) rotate(0deg)';
            item.style.opacity = '0';
            item.style.zIndex = '1';
            item.style.top = '50%';
            item.style.left = '50%';
          }
        });
      }

      if (mobilePrevBtn) {
        mobilePrevBtn.addEventListener('click', () => {
          mobileCurrentIndex = (mobileCurrentIndex - 1 + mobileItems.length) % mobileItems.length;
          updateMobileCarousel();
        });
      }

      if (mobileNextBtn) {
        mobileNextBtn.addEventListener('click', () => {
          mobileCurrentIndex = (mobileCurrentIndex + 1) % mobileItems.length;
          updateMobileCarousel();
        });
      }

      // Soporte para swipe en m√≥vil
      let touchStartX = 0;
      let touchEndX = 0;

      mobileContainer.addEventListener('touchstart', (e) => {
        touchStartX = e.changedTouches[0].screenX;
      });

      mobileContainer.addEventListener('touchend', (e) => {
        touchEndX = e.changedTouches[0].screenX;
        handleSwipe();
      });

      function handleSwipe() {
        if (touchEndX < touchStartX - 50) {
          // Swipe izquierda (siguiente)
          mobileCurrentIndex = (mobileCurrentIndex + 1) % mobileItems.length;
          updateMobileCarousel();
        }
        if (touchEndX > touchStartX + 50) {
          // Swipe derecha (anterior)
          mobileCurrentIndex = (mobileCurrentIndex - 1 + mobileItems.length) % mobileItems.length;
          updateMobileCarousel();
        }
      }

      updateMobileCarousel();
    }

    // Desktop Carousel
    const items = document.querySelectorAll('.carousel-item');
    const zoomBtn = document.getElementById('zoom-in-btn');
    const rotateBtn = document.getElementById('rotate-btn');

    if (items.length > 0) {
      const itemCount = items.length;
      const radius = 420;
      let currentRotation = 0;
      let currentZoom = 1;
      let rotateY = 0;

      function updateCarousel() {
        items.forEach((item, index) => {
          const angle = (360 / itemCount) * index + currentRotation;
          const radians = (angle * Math.PI) / 180;
          const x = Math.cos(radians) * radius;
          const z = Math.sin(radians) * radius;
          const zNormalized = (z + radius) / (radius * 2);
          const scale = 0.65 + zNormalized * 0.35;
          const opacity = 0.45 + zNormalized * 0.55;

          item.style.transform = `translateX(${x}px) translateZ(${z}px) scale(${scale})`;
          item.style.opacity = opacity;
          item.style.zIndex = Math.round(z);
        });
      }

      function rotateToItem(index) {
        const targetRotation = -(360 / itemCount) * index;
        currentRotation = targetRotation;
        updateCarousel();
      }

      items.forEach((item, index) => {
        item.addEventListener('click', () => rotateToItem(index));
      });

      if (zoomBtn) {
        zoomBtn.addEventListener('click', () => {
          currentZoom = currentZoom === 1 ? 1.15 : 1;
          items.forEach((item) => {
            item.style.transform += ` scale(${currentZoom})`;
          });
        });
      }

      if (rotateBtn) {
        rotateBtn.addEventListener('click', () => {
          rotateY = (rotateY + 45) % 360;
          items.forEach((item) => {
            item.style.transform += ` rotateY(${rotateY}deg)`;
          });
        });
      }

      rotateToItem(2);
    }
  });
</script>

{% schema %}
{
  "name": "Categories Showcase",
  "settings": [
    { "type": "text", "id": "title", "label": "T√≠tulo", "default": "Dise√±os Unicos Y Elegantes Para Tu D√≠a AD√≠a" },
    { "type": "text", "id": "subtitle", "label": "Subt√≠tulo", "default": "Soon-to-be staples in your rotation" },

    { "type": "text", "id": "category_1_label", "label": "Categor√≠a 1 - Texto fallback", "default": "Earring" },
    { "type": "product", "id": "category_1_product", "label": "Categor√≠a 1 - Producto" },

    { "type": "text", "id": "category_2_label", "label": "Categor√≠a 2 - Texto fallback", "default": "Bracelet" },
    { "type": "product", "id": "category_2_product", "label": "Categor√≠a 2 - Producto" },

    { "type": "text", "id": "category_3_label", "label": "Categor√≠a 3 - Texto fallback", "default": "Necklace" },
    { "type": "product", "id": "category_3_product", "label": "Categor√≠a 3 - Producto" },

    { "type": "text", "id": "category_4_label", "label": "Categor√≠a 4 - Texto fallback", "default": "Earring" },
    { "type": "product", "id": "category_4_product", "label": "Categor√≠a 4 - Producto" },

    { "type": "text", "id": "category_5_label", "label": "Categor√≠a 5 - Texto fallback", "default": "Accessories" },
    { "type": "product", "id": "category_5_product", "label": "Categor√≠a 5 - Producto" }
  ],
  "presets": [
    { "name": "Categories Showcase" }
  ]
}
{% endschema %}
