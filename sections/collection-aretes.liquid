{% comment %}
  Este template muestra productos de una colección 
  y luego permite filtrar por subtags: stud, huggies
{% endcomment %}

{% assign collection_handle = section.settings.collection_handle | default: "aretes" %}
{% assign target_collection = collections[collection_handle] %}

<div class="w-full bg-white py-12 md:py-16 lg:py-20 mb-12 md:mb-16">
    <div class="max-w-7xl mx-auto px-6 md:px-12 lg:px-32">
        
        {% paginate target_collection.products by section.settings.products_per_page %}
        
            <!-- Encabezado de la sección -->
            <div class="text-center mb-8 md:mb-12">
                <h1 class="text-3xl md:text-4xl lg:text-5xl font-bold text-gray-900 mb-4">
                    {{ section.settings.title | default: "Aretes" }}
                </h1>
                
                {% if section.settings.description != blank %}
                    <div class="max-w-3xl mx-auto text-base text-gray-600">
                        {{ section.settings.description }}
                    </div>
                {% endif %}
            </div>

            <!-- Filtros -->
            <div class="mb-8 md:mb-12">
                <div class="flex flex-col items-center">
                    <h2 class="text-xl md:text-2xl font-semibold text-gray-900 mb-6">
                        Filtrar por Tipo
                    </h2>
                    <div class="flex flex-wrap justify-center gap-4">
                        <button onclick="filterProducts('all')" id="filter-all" class="filter-btn px-6 py-3 rounded-lg font-medium transition-all duration-200 bg-gray-900 text-white">
                            Todos
                        </button>
                        <button onclick="filterProducts('stud')" id="filter-stud" class="filter-btn px-6 py-3 rounded-lg font-medium transition-all duration-200 bg-gray-200 text-gray-700 hover:bg-gray-300">
                            Stud
                        </button>
                        <button onclick="filterProducts('huggies')" id="filter-huggies" class="filter-btn px-6 py-3 rounded-lg font-medium transition-all duration-200 bg-gray-200 text-gray-700 hover:bg-gray-300">
                            Huggies
                        </button>
                    </div>
                    
                    <!-- Nombre del filtro activo -->
                    <div class="mt-6 text-lg text-gray-600">
                        Mostrando: <span id="filter-name" class="font-semibold text-gray-900">Todos los aretes</span>
                    </div>
                </div>
            </div>

            <!-- Grid de productos - 4 columnas -->
            {% if paginate.items.size > 0 %}
                <div class="grid grid-cols-2 md:grid-cols-4 gap-6 md:gap-8" id="products-grid">
                    {% for product in paginate.items %}
                        {% assign product_tags = product.tags | join: ',' | downcase %}
                        <div class="product-item" data-tags="{{ product_tags }}">
                            {% render 'product-card', product_product: product %}
                        </div>
                    {% endfor %}
                </div>

                <!-- Contador de productos visibles -->
                <div class="mt-8 text-center text-sm text-gray-500">
                    <span id="visible-count">{{ paginate.items.size }}</span> de {{ paginate.items }} productos
                </div>

                <!-- Paginación -->
                {% if paginate.pages > 1 %}
                    <div class="mt-12">
                        {% render 'pagination', pagination: paginate %}
                    </div>
                {% endif %}
            {% else %}
                <!-- Estado vacío -->
                <div class="text-center py-16">
                    <svg class="w-24 h-24 mx-auto mb-6 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"></path>
                    </svg>
                    <h2 class="text-2xl font-semibold text-gray-900 mb-2">
                        No hay productos en esta colección
                    </h2>
                    <p class="text-gray-600 mb-8">
                        Esta colección está vacía actualmente
                    </p>
                    <a href="{{ routes.all_products_url }}" class="inline-block px-6 py-3 text-white font-semibold rounded-lg transition-colors" style="background-color: #222121; hover:background-color: #333;">
                        Ver todos los productos
                    </a>
                </div>
            {% endif %}

        {% endpaginate %}

    </div>
</div>

<script>
function filterProducts(filterType) {
    const productItems = document.querySelectorAll('.product-item');
    const filterButtons = document.querySelectorAll('.filter-btn');
    const filterNameElement = document.getElementById('filter-name');
    const visibleCountElement = document.getElementById('visible-count');
    let visibleCount = 0;

    // Actualizar estilos de botones
    filterButtons.forEach(btn => {
        btn.classList.remove('bg-gray-900', 'text-white');
        btn.classList.add('bg-gray-200', 'text-gray-700', 'hover:bg-gray-300');
    });
    
    const activeButton = document.getElementById('filter-' + filterType);
    activeButton.classList.remove('bg-gray-200', 'text-gray-700', 'hover:bg-gray-300');
    activeButton.classList.add('bg-gray-900', 'text-white');

    // Actualizar nombre del filtro
    const filterNames = {
        'all': 'Todos los aretes',
        'stud': 'Aretes Stud',
        'huggies': 'Aretes Huggies'
    };
    filterNameElement.textContent = filterNames[filterType];

    // Filtrar productos
    productItems.forEach(item => {
        const tags = item.dataset.tags;
        
        if (filterType === 'all') {
            item.style.display = 'block';
            visibleCount++;
        } else if (tags.includes(filterType)) {
            item.style.display = 'block';
            visibleCount++;
        } else {
            item.style.display = 'none';
        }
    });

    // Actualizar contador
    visibleCountElement.textContent = visibleCount;
}

// Inicializar con todos los productos visibles
document.addEventListener('DOMContentLoaded', function() {
    const totalProducts = document.querySelectorAll('.product-item').length;
    document.getElementById('visible-count').textContent = totalProducts;
});
</script>

<style>
    .filter-btn {
        min-width: 120px;
    }
    
    .filter-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    
    .product-item {
        transition: opacity 0.3s ease;
    }
</style>

{% schema %}
{
    "name": "Colección Aretes",
    "class": "shopify-section--aretes",
    "settings": [
        {
            "type": "collection",
            "id": "collection_handle",
            "label": "Colección de aretes",
            "info": "Selecciona la colección que contiene los aretes"
        },
        {
            "type": "text",
            "id": "title",
            "label": "Título de la sección",
            "default": "Aretes"
        },
        {
            "type": "textarea",
            "id": "description",
            "label": "Descripción",
            "info": "Descripción opcional para mostrar debajo del título"
        },
        {
            "type": "range",
            "id": "products_per_page",
            "min": 8,
            "max": 48,
            "step": 4,
            "label": "Productos por página",
            "default": 12
        },
        {
            "type": "paragraph",
            "content": "Esta sección muestra productos de una colección. Puedes filtrar por 'stud' o 'huggies' usando los botones."
        }
    ]
}
{% endschema %}
