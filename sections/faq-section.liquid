{% comment %}
  FAQ Section - Refactored for improved maintainability
  Preserves original design and functionality
{% endcomment %}

{% liquid
  assign section_title = section.settings.title
  assign section_description = section.settings.description
  assign faq_image = section.settings.faq_image
  assign faq_video = section.settings.faq_video
  assign faq_video_file = section.settings.faq_video_file
  assign use_video = section.settings.use_video
  assign show_contact = section.settings.show_contact_field
  assign contact_placeholder = section.settings.contact_placeholder
  assign contact_button_text = section.settings.contact_button_text
  assign contact_link = section.settings.contact_link
%}

<section class="faq-section" data-section-id="{{ section.id }}" data-section-type="faq-section">
  <div class="faq-section__container">
    
    <!-- Header -->
    <header class="faq-section__header">
      <h2 class="faq-section__title">{{ section_title }}</h2>
      {% if section_description != blank %}
        <p class="faq-section__description">{{ section_description }}</p>
      {% endif %}
    </header>

    <!-- Content Grid -->
    <div class="faq-section__grid">
      
      <!-- Image/Video Column -->
      <div class="faq-section__image-wrapper">
        {% if use_video and faq_video %}
          {% if faq_video.type == 'youtube' %}
            <iframe
              class="faq-section__video"
              src="https://www.youtube.com/embed/{{ faq_video.id }}?autoplay=1&mute=1&loop=1&playlist={{ faq_video.id }}&controls=0&showinfo=0&rel=0&modestbranding=1"
              frameborder="0"
              allow="autoplay; encrypted-media"
              allowfullscreen
              width="500"
              height="450">
            </iframe>
          {% elsif faq_video.type == 'vimeo' %}
            <iframe
              class="faq-section__video"
              src="https://player.vimeo.com/video/{{ faq_video.id }}?autoplay=1&muted=1&loop=1&background=1"
              frameborder="0"
              allow="autoplay; fullscreen; picture-in-picture"
              allowfullscreen
              width="500"
              height="450">
            </iframe>
          {% endif %}
        {% elsif use_video and faq_video_file %}
          <video 
            class="faq-section__video"
            autoplay
            muted
            loop
            playsinline
            width="500"
            height="450">
            <source src="{{ faq_video_file }}" type="video/mp4">
            Tu navegador no soporta el video.
          </video>
        {% elsif faq_image %}
          {{ faq_image | image_url: width: 500 | image_tag: 
            alt: 'FAQ Image',
            width: 500,
            height: 450,
            loading: 'lazy',
            class: 'faq-section__image'
          }}
        {% else %}
          <img 
            src="{{ 'faq.jpeg' | asset_url }}" 
            alt="FAQ Image"
            width="500"
            height="450"
            loading="lazy"
            class="faq-section__image">
        {% endif %}
      </div>

      <!-- Accordion Column -->
      <div class="faq-section__accordion">
        {% if section.blocks.size > 0 %}
          <div class="faq-accordion" role="region" aria-label="Preguntas frecuentes">
            {% for block in section.blocks %}
              {% liquid
                assign block_question = block.settings.question
                assign block_answer = block.settings.answer
                assign accordion_id = 'faq-item-' | append: block.id
                assign button_id = 'faq-button-' | append: block.id
                assign panel_id = 'faq-panel-' | append: block.id
              %}
              
              <div 
                class="faq-accordion__item" 
                data-block-id="{{ block.id }}"
                {{ block.shopify_attributes }}>
                
                <!-- Question Button -->
                <button 
                  type="button"
                  id="{{ button_id }}"
                  class="faq-accordion__button"
                  aria-expanded="false"
                  aria-controls="{{ panel_id }}"
                  data-faq-button>
                  <span class="faq-accordion__question">{{ block_question }}</span>
                  <svg 
                    class="faq-accordion__icon" 
                    aria-hidden="true"
                    fill="none" 
                    stroke="currentColor" 
                    viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                  </svg>
                </button>
                
                <!-- Answer Panel -->
                <div 
                  id="{{ panel_id }}"
                  class="faq-accordion__panel"
                  role="region"
                  aria-labelledby="{{ button_id }}"
                  hidden>
                  <div class="faq-accordion__answer">
                    {{ block_answer }}
                  </div>
                </div>
              </div>
            {% endfor %}
          </div>
        {% endif %}

        <!-- Contact Field -->
        {% if show_contact %}
          <div class="faq-section__contact">
            <div class="faq-section__contact-inner">
              <input 
                type="text" 
                placeholder="{{ contact_placeholder }}"
                aria-label="{{ contact_placeholder }}"
                class="faq-section__contact-input">
              {% if contact_link != blank %}
                <a 
                  href="{{ contact_link }}" 
                  class="faq-section__contact-button">
                  {{ contact_button_text }}
                </a>
              {% endif %}
            </div>
          </div>
        {% endif %}
      </div>

    </div>

  </div>
</section>

<style>
  /* FAQ Section - Component Styles */
  .faq-section {
    background-color: #2d2d2d;
    color: white;
    padding: 4rem 1rem;
  }

  .faq-section__container {
    max-width: 80rem;
    margin: 0 auto;
  }

  /* Header */
  .faq-section__header {
    text-align: center;
    margin-bottom: 3rem;
  }

  .faq-section__title {
    font-size: 1.875rem;
    font-weight: 700;
    margin-bottom: 1rem;
  }

  @media (min-width: 768px) {
    .faq-section__title {
      font-size: 2.25rem;
    }
  }

  .faq-section__description {
    color: #d1d5db;
    font-size: 0.875rem;
    max-width: 48rem;
    margin: 0 auto;
  }

  /* Grid Layout */
  .faq-section__grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 2rem;
    align-items: start;
  }

  @media (min-width: 768px) {
    .faq-section__grid {
      grid-template-columns: repeat(2, 1fr);
      gap: 4rem;
    }
  }

  @media (min-width: 1024px) {
    .faq-section__grid {
      gap: 5rem;
    }
  }

  /* Image/Video */
  .faq-section__image-wrapper {
    background-color: #d8b4fe;
    border-radius: 0.5rem;
    overflow: hidden;
    height: 20rem;
    max-width: 28rem;
    margin: 0 auto;
  }

  .faq-section__video {
    width: 100%;
    height: 100%;
    object-fit: cover;
    border: none;
  }

  @media (min-width: 768px) {
    .faq-section__image-wrapper {
      height: 24rem;
      margin: 0;
    }
  }

  @media (min-width: 1024px) {
    .faq-section__image-wrapper {
      height: 450px;
    }
  }

  .faq-section__image {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  /* Accordion */
  .faq-section__accordion {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .faq-accordion__item {
    border-bottom: 1px solid #4b5563;
    padding-bottom: 1rem;
  }

  .faq-accordion__button {
    width: 100%;
    display: flex;
    align-items: center;
    justify-content: space-between;
    text-align: left;
    padding: 0.75rem 0;
    background: none;
    border: none;
    color: white;
    cursor: pointer;
    transition: color 0.2s ease;
  }

  .faq-accordion__button:hover {
    color: #C99B63;
  }

  .faq-accordion__button:focus-visible {
    outline: 2px solid #C99B63;
    outline-offset: 2px;
  }

  .faq-accordion__question {
    font-size: 1rem;
    font-weight: 500;
    padding-right: 1rem;
  }

  @media (min-width: 768px) {
    .faq-accordion__question {
      font-size: 1.125rem;
    }
  }

  .faq-accordion__icon {
    width: 1.5rem;
    height: 1.5rem;
    flex-shrink: 0;
    transition: transform 0.2s ease;
  }

  .faq-accordion__button[aria-expanded="true"] .faq-accordion__icon {
    transform: rotate(45deg);
  }

  .faq-accordion__panel {
    overflow: hidden;
    transition: height 0.3s ease;
  }

  .faq-accordion__answer {
    color: #d1d5db;
    font-size: 0.875rem;
    line-height: 1.6;
    padding-top: 0.5rem;
  }

  /* Contact Section */
  .faq-section__contact {
    margin-top: 2rem;
    padding-top: 1.5rem;
    border-top: 1px solid #4b5563;
  }

  .faq-section__contact-inner {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  @media (min-width: 768px) {
    .faq-section__contact-inner {
      flex-direction: row;
    }
  }

  .faq-section__contact-input {
    flex: 1;
    padding: 0.75rem 1rem;
    border-radius: 0.5rem;
    background-color: #2e2822;
    color: white;
    border: 1px solid #5a4a45;
  }

  .faq-section__contact-input:focus {
    outline: 2px solid #C99B63;
    outline-offset: 2px;
  }

  .faq-section__contact-button {
    padding: 0.75rem 1.5rem;
    text-align: center;
    font-weight: 600;
    border-radius: 0.5rem;
    background-color: white;
    color: #3E382C;
    transition: all 0.2s ease;
    text-decoration: none;
    display: inline-block;
  }

  .faq-section__contact-button:hover {
    background-color: #C99B63;
    color: white;
  }

  .faq-section__contact-button:focus-visible {
    outline: 2px solid #C99B63;
    outline-offset: 2px;
  }

  /* Reduced Motion Support */
  @media (prefers-reduced-motion: reduce) {
    .faq-accordion__button,
    .faq-accordion__icon,
    .faq-accordion__panel,
    .faq-section__contact-button {
      transition: none;
    }
  }
</style>

<script>
  /**
   * FAQ Accordion Component
   * Handles expand/collapse interactions with accessibility support
   */
  (function() {
    'use strict';

    const SELECTORS = {
      button: '[data-faq-button]',
      panel: '.faq-accordion__panel'
    };

    const ANIMATION_DURATION = 300; // ms
    const REDUCED_MOTION_QUERY = '(prefers-reduced-motion: reduce)';

    /**
     * Initialize FAQ accordion functionality
     */
    function initFAQAccordion() {
      const buttons = document.querySelectorAll(SELECTORS.button);
      
      if (buttons.length === 0) return;

      buttons.forEach(button => {
        button.addEventListener('click', handleAccordionClick);
      });

      // Keyboard navigation
      document.addEventListener('keydown', handleKeyboardNavigation);
    }

    /**
     * Handle accordion button click
     * @param {Event} event - Click event
     */
    function handleAccordionClick(event) {
      const button = event.currentTarget;
      const isExpanded = button.getAttribute('aria-expanded') === 'true';
      const panelId = button.getAttribute('aria-controls');
      const panel = document.getElementById(panelId);

      if (!panel) return;

      if (isExpanded) {
        collapsePanel(button, panel);
      } else {
        expandPanel(button, panel);
      }
    }

    /**
     * Expand accordion panel
     * @param {HTMLElement} button - Accordion button
     * @param {HTMLElement} panel - Accordion panel
     */
    function expandPanel(button, panel) {
      const prefersReducedMotion = window.matchMedia(REDUCED_MOTION_QUERY).matches;
      
      button.setAttribute('aria-expanded', 'true');
      panel.hidden = false;

      if (prefersReducedMotion) {
        return;
      }

      // Animate expansion
      const content = panel.querySelector('.faq-accordion__answer');
      const height = content.offsetHeight;
      
      panel.style.height = '0';
      requestAnimationFrame(() => {
        panel.style.transition = `height ${ANIMATION_DURATION}ms ease`;
        panel.style.height = height + 'px';
        
        setTimeout(() => {
          panel.style.height = 'auto';
        }, ANIMATION_DURATION);
      });
    }

    /**
     * Collapse accordion panel
     * @param {HTMLElement} button - Accordion button
     * @param {HTMLElement} panel - Accordion panel
     */
    function collapsePanel(button, panel) {
      const prefersReducedMotion = window.matchMedia(REDUCED_MOTION_QUERY).matches;
      
      button.setAttribute('aria-expanded', 'false');

      if (prefersReducedMotion) {
        panel.hidden = true;
        return;
      }

      // Animate collapse
      const height = panel.offsetHeight;
      panel.style.height = height + 'px';
      
      requestAnimationFrame(() => {
        panel.style.transition = `height ${ANIMATION_DURATION}ms ease`;
        panel.style.height = '0';
        
        setTimeout(() => {
          panel.hidden = true;
          panel.style.height = '';
          panel.style.transition = '';
        }, ANIMATION_DURATION);
      });
    }

    /**
     * Handle keyboard navigation
     * @param {KeyboardEvent} event - Keyboard event
     */
    function handleKeyboardNavigation(event) {
      const target = event.target;
      
      if (!target.matches(SELECTORS.button)) return;

      const buttons = Array.from(document.querySelectorAll(SELECTORS.button));
      const currentIndex = buttons.indexOf(target);

      let nextIndex = -1;

      switch (event.key) {
        case 'ArrowDown':
          event.preventDefault();
          nextIndex = (currentIndex + 1) % buttons.length;
          break;
        case 'ArrowUp':
          event.preventDefault();
          nextIndex = (currentIndex - 1 + buttons.length) % buttons.length;
          break;
        case 'Home':
          event.preventDefault();
          nextIndex = 0;
          break;
        case 'End':
          event.preventDefault();
          nextIndex = buttons.length - 1;
          break;
      }

      if (nextIndex !== -1) {
        buttons[nextIndex].focus();
      }
    }

    // Initialize on DOM ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initFAQAccordion);
    } else {
      initFAQAccordion();
    }

    // Reinitialize for Shopify theme editor
    if (Shopify && Shopify.designMode) {
      document.addEventListener('shopify:section:load', initFAQAccordion);
    }
  })();
</script>

{% schema %}
{
    "name": "FAQ Section",
    "settings": [
        {
            "type": "text",
            "id": "title",
            "default": "Preguntas Frecuentes",
            "label": "Título"
        },
        {
            "type": "textarea",
            "id": "description",
            "default": "Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam.",
            "label": "Descripción"
        },
        {
            "type": "checkbox",
            "id": "use_video",
            "label": "Usar video en lugar de imagen",
            "default": false
        },
        {
            "type": "header",
            "content": "Opción 1: Video de YouTube o Vimeo"
        },
        {
            "type": "video_url",
            "id": "faq_video",
            "label": "URL de video (YouTube/Vimeo)",
            "accept": ["youtube", "vimeo"],
            "info": "Pega la URL de YouTube o Vimeo"
        },
        {
            "type": "header",
            "content": "Opción 2: Video de la biblioteca de Shopify"
        },
        {
            "type": "url",
            "id": "faq_video_file",
            "label": "Archivo de video (MP4)",
            "info": "Sube un archivo .mp4 desde la biblioteca de archivos de Shopify. Usa esto si no tienes URL de YouTube/Vimeo."
        },
        {
            "type": "image_picker",
            "id": "faq_image",
            "label": "Imagen lateral",
            "info": "Se mostrará solo si 'Usar video' está desactivado"
        },
        {
            "type": "checkbox",
            "id": "show_contact_field",
            "label": "Mostrar campo de contacto",
            "default": true
        },
        {
            "type": "text",
            "id": "contact_placeholder",
            "default": "Tienes otras preguntas? Dejanos un mensaje",
            "label": "Texto del campo de contacto"
        },
        {
            "type": "text",
            "id": "contact_button_text",
            "default": "PREGUNTAS",
            "label": "Texto del botón"
        },
        {
            "type": "url",
            "id": "contact_link",
            "label": "Enlace del botón"
        }
    ],
    "blocks": [
        {
            "type": "faq_item",
            "name": "Pregunta",
            "settings": [
                {
                    "type": "text",
                    "id": "question",
                    "label": "Pregunta",
                    "default": "¿Qué Es El Oro De 9k?"
                },
                {
                    "type": "textarea",
                    "id": "answer",
                    "label": "Respuesta",
                    "default": "El oro de 9k es una aleación de oro duradera y hermosa que ofrece el equilibrio perfecto entre elegancia y resistencia para el uso diario. Combina oro real mezclado con otros metales para crear una pieza fuerte y duradera, ideal para llevar todos los días."
                }
            ]
        }
    ],
    "presets": [
        {
            "name": "FAQ Section",
            "blocks": [
                {
                    "type": "faq_item",
                    "settings": {
                        "question": "¿Qué Es El Oro De 9k?",
                        "answer": "El oro de 9k es una aleación de oro duradera y hermosa que ofrece el equilibrio perfecto entre elegancia y resistencia para el uso diario. Combina oro real mezclado con otros metales para crear una pieza fuerte y duradera, ideal para llevar todos los días."
                    }
                },
                {
                    "type": "faq_item",
                    "settings": {
                        "question": "¿Puedo Usar Mi Joyería Todos Los Días?",
                        "answer": "Sí, nuestras joyas de oro 9k están diseñadas específicamente para el uso diario. Son duraderas y resistentes."
                    }
                },
                {
                    "type": "faq_item",
                    "settings": {
                        "question": "¿Es Su Joyería Hipoalergénica?",
                        "answer": "Sí, nuestras joyas son hipoalergénicas y seguras para pieles sensibles."
                    }
                },
                {
                    "type": "faq_item",
                    "settings": {
                        "question": "¿Cómo Debo Cuidar Mi Joyería?",
                        "answer": "Limpia tus joyas con un paño suave y guárdalas en un lugar seco cuando no las uses."
                    }
                },
                {
                    "type": "faq_item",
                    "settings": {
                        "question": "¿Ofrecen Devoluciones O Cambios?",
                        "answer": "Sí, aceptamos devoluciones y cambios dentro de los 30 días de la compra."
                    }
                },
                {
                    "type": "faq_item",
                    "settings": {
                        "question": "¿Cuánto Tardará Mi Pedido En Llegar?",
                        "answer": "Los pedidos generalmente llegan en 5-7 días hábiles."
                    }
                }
            ]
        }
    ]
}
{% endschema %}
