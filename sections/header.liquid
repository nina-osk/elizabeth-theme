{% liquid 
    if section.settings.menu.links == blank
        assign main_menu_linklist = linklists[section.settings.menu].links
    else
        assign main_menu_linklist = section.settings.menu.links
    endif
%}

<!-- Top Announcement Bar - Sage Green Background -->
{% if section.settings.announcement_text != blank %}
<div class="w-full border-b border-gray-200" style="background-color: #C8D5C7;">
  <div class="mx-auto px-4 py-2.5">
    <p class="text-center text-xs md:text-sm text-gray-900 font-medium">
      {{ section.settings.announcement_text }}
    </p>
  </div>
</div>
{% endif %}

<div class="relative bg-white" x-data="{ mobileMenuOpen: false, searchBarOpen: false }" x-cloak>
  <div class="mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex justify-between items-center py-3 md:py-4 md:justify-start md:space-x-8">
      
      <!-- LOGO - Replaces Home link -->
      <div class="flex justify-start lg:flex-1">
        <a href="{{ routes.root_url }}" class="flex items-center">
          {% if section.settings.logo != blank %}
            <img 
              src="{{ section.settings.logo | image_url: width: 200 }}" 
              alt="{{ shop.name }}"
              width="{{ section.settings.logo.width }}"
              height="{{ section.settings.logo.height }}"
              loading="eager"
              class="h-10 md:h-14 w-auto"
            >
          {% else %}
            <span class="text-xl md:text-2xl font-bold text-gray-900">{{ shop.name }}</span>
          {% endif %}
        </a>
      </div>
      
      <!-- Mobile menu button -->
      <div class="-mr-2 -my-2 ml-3 md:hidden">
        <button x-on:click="mobileMenuOpen = true" type="button" class="bg-white p-2 inline-flex items-center justify-center focus:outline-none hover:bg-gray-50 rounded-md transition-colors">
          {% render 'icon-menu-bar3' %}
        </button>
      </div>

      <!-- NAVIGATION MENU -->
      <nav x-data="{ open: false }" class="hidden md:flex space-x-10 lg:space-x-16">
        {% for link in main_menu_linklist %}
          {% if link.links != blank %}
            {% assign link_handle = link.handle | replace: '-', '_' %}
            <div x-data="{ {{link_handle}}: false }" class="relative">
              <button 
                x-on:click="{{link_handle}} = !{{link_handle}}" 
                type="button" 
                class="inline-flex items-center text-sm lg:text-base font-medium text-gray-700 hover:text-gray-900 transition-colors duration-200"
              >
                {{ link.title }}
                {% render 'icon-dropdown' %}
              </button>
              
              <div 
                x-show="{{link_handle}}" 
                @click.away="{{link_handle}} = false" 
                x-transition:enter="transition ease-out duration-200"
                x-transition:enter-start="opacity-0 translate-y-1"
                x-transition:enter-end="opacity-100 translate-y-0"
                x-transition:leave="transition ease-in duration-150"
                x-transition:leave-start="opacity-100 translate-y-0"
                x-transition:leave-end="opacity-0 translate-y-1"
                class="absolute z-10 -ml-5 mt-3 transform px-2 w-screen max-w-md sm:px-0 lg:ml-0 lg:left-1/2 lg:-translate-x-1/2"
              >
                <div class="shadow-lg border border-gray-200 ring-1 ring-black ring-opacity-5 overflow-hidden rounded-lg">
                  <div class="relative grid gap-6 bg-white px-5 py-6 sm:gap-8 sm:p-8">
                    {% for childlink in link.links %}
                      <a 
                        href="{{ childlink.url }}" 
                        class="-m-3 p-3 flex items-start rounded-lg hover:bg-gray-50 transition-colors duration-200"
                      >
                        <div class="ml-4">
                          <p class="text-gray-900 text-base font-medium">
                            {{ childlink.title }}
                          </p>
                        </div>
                      </a>
                    {% endfor %}
                  </div>
                </div>
              </div>
            </div>
          {% else %}
            <a 
              href="{{ link.url }}" 
              class="text-sm lg:text-base font-medium text-gray-700 hover:text-gray-900 transition-colors duration-200"
            >
              {{ link.title }}
            </a>
          {% endif %}
        {% endfor %}
      </nav>

      <!-- CART BUTTON / ACCOUNT LINKS -->
      <div class="hidden md:flex items-center justify-end md:flex-1 space-x-5 lg:space-x-6">
        <a 
          href="{{ routes.cart_url }}" 
          class="whitespace-nowrap text-sm lg:text-base font-medium text-gray-700 hover:text-gray-900 flex items-center gap-2 transition-colors duration-200"
        >
          {% render 'icon-shopping-cart' %} 
          <span>({{ cart.item_count }})</span>
        </a>

  
      </div>
    </div>
  </div>

    <!-- MOBILE MENU -->
    <div 
      x-show="mobileMenuOpen" 
      x-transition:enter="transition ease-out duration-300"
      x-transition:enter-start="opacity-0 scale-95"
      x-transition:enter-end="opacity-100 scale-100"
      x-transition:leave="transition ease-in duration-200"
      x-transition:leave-start="opacity-100 scale-100"
      x-transition:leave-end="opacity-0 scale-95"
      class="absolute z-50 top-0 inset-x-0 p-2 transform origin-top-right md:hidden"
    >
      <div class="shadow-xl rounded-lg ring-1 ring-black ring-opacity-5 bg-white w-full">
        <div class="p-5 divide-y-2 divide-gray-100">

          <!-- MOBILE MENU HEADER -->
          <div class="flex items-center justify-between pb-4">
            <div>
              <h1 class="text-lg font-semibold text-gray-900">{{ section.settings.mobile_menu_label }}</h1>
            </div>
            <div class="-mr-2">
              <button 
                x-on:click="mobileMenuOpen = false"  
                type="button" 
                class="bg-white rounded-md p-2 text-gray-500 hover:bg-gray-100 transition-colors"
              >
                {% render 'icon-x-mark' %}
              </button>
            </div>
          </div>

          <!-- NAVIGATION LINKS FOR MOBILE -->
          <div class="pt-4">
            <nav class="grid gap-y-6">
              {% for link in main_menu_linklist %}
                {% assign link_handle = link.handle | replace: '-', '_' %}
                {% if link.links != blank %}    
                  <div x-data="{ {{link_handle}}: false }" class="relative">
                    <button 
                      x-on:click="{{link_handle}} = !{{link_handle}}" 
                      type="button" 
                      class="text-base font-medium text-gray-700 hover:text-gray-900 flex items-center justify-between w-full transition-colors"
                    >
                      <div>{{ link.title }}</div>
                      {% render 'icon-dropdown' %}
                    </button>
                    <div 
                      x-show="{{link_handle}}" 
                      x-transition
                      class="mt-2 pl-4 border-l-2 border-gray-200"
                    >
                      {% for childlink in link.links %}
                        <div class="py-2">
                          <a 
                            href="{{ childlink.url }}" 
                            class="block p-3 rounded-md text-base font-medium text-gray-600 hover:text-gray-900 hover:bg-gray-50 transition-colors"
                          >
                            {{ childlink.title }}
                          </a>
                        </div>
                      {% endfor %}
                    </div>
                  </div>
                {% else %}
                  <a 
                    href="{{ link.url }}" 
                    class="block p-3 rounded-md text-base font-medium text-gray-700 hover:text-gray-900 hover:bg-gray-50 transition-colors"
                  >
                    {{ link.title }}
                  </a>
                {% endif %}
              {% endfor %}
            </nav>
          </div>

          <!-- MOBILE ACCOUNT & CART -->
          <div class="pt-4 mt-4">
            <div class="flex flex-col space-y-3">
              <a 
                href="{{ routes.cart_url }}" 
                class="flex items-center justify-between p-3 rounded-md text-base font-medium text-gray-700 hover:bg-gray-50 transition-colors"
              >
                <span>Carrito</span>
                <span class="flex items-center gap-2">
                  {% render 'icon-shopping-cart' %}
                  ({{ cart.item_count }})
                </span>
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
</div>

{%  schema %}
{
  "name": "Header",
  "settings": [
    {
      "type": "image_picker",
      "id": "logo",
      "label": "Logo",
      "info": "Recomendado: PNG con fondo transparente, 200-400px de ancho. Reemplaza el texto 'Home' en la navegación."
    },
    {
      "type": "text",
      "id": "announcement_text",
      "label": "Texto del anuncio superior",
      "default": "Best Special Offers Every Week. 40% Off! Free Delivery Time.",
      "info": "Aparece en la barra verde superior. Déjalo vacío para ocultarla."
    },
    {
      "type": "link_list",
      "id": "menu",
      "label": "Menú de navegación",
      "default": "main-menu"
    },
    {
      "type": "text",
      "id": "mobile_menu_label",
      "label": "Etiqueta del menú móvil",
      "default": "Menú",
      "info": "Este es el título de la ventana del menú móvil."
    }
  ]
}
{% endschema %}