{% liquid 
    if section.settings.menu.links == blank
        assign main_menu_linklist = linklists[section.settings.menu].links
    else
        assign main_menu_linklist = section.settings.menu.links
    endif
%}

<!-- Top Announcement Bar - Sage Green Background -->
{% if section.settings.announcement_text != blank %}
<div style="width: 100%; background-color: #C8D5C7; border-bottom: 1px solid rgba(0,0,0,0.1);">
  <div style="max-width: 1280px; margin: 0 auto; padding: 0.625rem 1rem;">
    <p style="text-align: center; font-size: 0.8125rem; color: #2d2d2d; font-weight: 500;">
      {{ section.settings.announcement_text }}
    </p>
  </div>
</div>
{% endif %}

<div style="position: relative; background-color: white !important;" x-data="{ mobileMenuOpen: false }">
  <div style="max-width: 1400px; margin: 0 auto; padding: 1.5rem 2rem;">
    
    <!-- Header Row -->
    <div style="display: flex; align-items: center; justify-content: space-between; gap: 3rem;" class="header-row">
      
      <!-- Mobile menu button - Left side -->
      <div style="display: flex; align-items: center;">
        <button x-on:click="mobileMenuOpen = true" type="button" style="background: none; border: none; padding: 0.5rem; cursor: pointer; display: none;" class="mobile-menu-btn">
          {% render 'icon-menu-bar3' %}
        </button>
      </div>
      
      <!-- LOGO - Left/Center -->
      <div style="display: flex; align-items: center; flex-shrink: 0; margin-right: auto;" class="logo-container">
        <a href="{{ routes.root_url }}" style="display: inline-block; text-decoration: none;">
          {% if section.settings.logo != blank %}
            <img 
              src="{{ section.settings.logo | image_url: width: 400 }}" 
              alt="{{ shop.name }}"
              width="200"
              height="100"
              loading="eager"
              style="height: auto; width: auto; max-height: 3rem; max-width: 200px;"
            >
          {% else %}
            <span style="font-size: 1.5rem; font-weight: 700; color: #2d2d2d; letter-spacing: 0.1em;">MUNIER</span>
          {% endif %}
        </a>
      </div>

      <!-- NAVIGATION MENU - Center/Right -->
      <nav style="display: flex; align-items: center; gap: 2rem; flex: 1; justify-content: center;" class="desktop-nav">
        {% for link in main_menu_linklist %}
          {% if link.links != blank %}
            {% assign link_handle = link.handle | replace: '-', '_' %}
            <div x-data="{ {{link_handle}}: false }" style="position: relative;">
              <button 
                x-on:click="{{link_handle}} = !{{link_handle}}" 
                type="button" 
                class="nav-link"
                style="background: none; border: none; font-size: 0.75rem; font-weight: 600; color: #2d2d2d; text-transform: uppercase; letter-spacing: 0.08em; cursor: pointer; padding: 0.5rem 0; display: flex; align-items: center; gap: 0.25rem; position: relative; white-space: nowrap;"
              >
                {{ link.title }}
                {% render 'icon-dropdown' %}
              </button>
              
              <div 
                x-show="{{link_handle}}" 
                @click.away="{{link_handle}} = false" 
                x-transition:enter="transition ease-out duration-200"
                x-transition:enter-start="opacity-0 translate-y-1"
                x-transition:enter-end="opacity-100 translate-y-0"
                x-transition:leave="transition ease-in duration-150"
                x-transition:leave-start="opacity-100 translate-y-0"
                x-transition:leave-end="opacity-0 translate-y-1"
                style="position: absolute; z-index: 50; margin-top: 0.75rem; left: 50%; transform: translateX(-50%); min-width: 250px;"
              >
                <div style="box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); border: 1px solid #e5e7eb; border-radius: 0.5rem; overflow: hidden;">
                  <div style="background-color: white; padding: 1.5rem;">
                    {% for childlink in link.links %}
                      <a 
                        href="{{ childlink.url }}" 
                        style="display: block; padding: 0.75rem; margin: -0.25rem; text-decoration: none; border-radius: 0.5rem; transition: background-color 0.2s;"
                        onmouseover="this.style.backgroundColor='#F5F1E8'" 
                        onmouseout="this.style.backgroundColor='transparent'"
                      >
                        <p style="color: #2d2d2d; font-size: 0.9375rem; font-weight: 500; margin: 0;">
                          {{ childlink.title }}
                        </p>
                      </a>
                    {% endfor %}
                  </div>
                </div>
              </div>
            </div>
          {% else %}
            <a 
              href="{{ link.url }}" 
              class="nav-link {% if link.active %}active-link{% endif %}"
              style="font-size: 0.75rem; font-weight: 600; color: #2d2d2d; text-transform: uppercase; letter-spacing: 0.08em; text-decoration: none; padding: 0.5rem 0; position: relative; display: inline-block; white-space: nowrap;"
            >
              {{ link.title }}
            </a>
          {% endif %}
        {% endfor %}
      </nav>
      
      <!-- User Account & Cart - Right side -->
      <div style="display: flex; align-items: center; gap: 1.5rem; flex-shrink: 0;" class="desktop-nav">
        <!-- Search -->
        <a 
          href="{{ routes.search_url }}" 
          style="font-size: 0.875rem; font-weight: 500; color: #2d2d2d; text-decoration: none; display: flex; align-items: center; gap: 0.5rem;"
          title="Buscar"
        >
          {% render 'icon-search' %}
        </a>
        
        <!-- User Account -->
        <a 
          href="{{ routes.account_url }}" 
          style="font-size: 0.875rem; font-weight: 500; color: #2d2d2d; text-decoration: none; display: flex; align-items: center; gap: 0.5rem;"
          title="{% if customer %}Mi cuenta{% else %}Iniciar sesión{% endif %}"
        >
          {% render 'icon-user' %}
        </a>
        
        <!-- Cart -->
        <a 
          href="{{ routes.cart_url }}" 
          style="font-size: 0.875rem; font-weight: 500; color: #2d2d2d; text-decoration: none; display: flex; align-items: center; gap: 0.5rem; white-space: nowrap;"
        >
          {% render 'icon-shopping-bag' %} 
          <span>({{ cart.item_count }})</span>
        </a>
      </div>
    </div>

    <!-- MOBILE MENU -->
    <div 
      x-show="mobileMenuOpen" 
      x-transition:enter="transition ease-out duration-300"
      x-transition:enter-start="opacity-0 scale-95"
      x-transition:enter-end="opacity-100 scale-100"
      x-transition:leave="transition ease-in duration-200"
      x-transition:leave-start="opacity-100 scale-100"
      x-transition:leave-end="opacity-0 scale-95"
      class="absolute z-50 top-0 inset-x-0 p-2 transform origin-top-right md:hidden"
    >
      <div class="shadow-xl rounded-lg ring-1 ring-black ring-opacity-5 bg-white w-full">
        <div class="p-5 divide-y-2 divide-gray-100">

          <!-- MOBILE MENU HEADER -->
          <div class="flex items-center justify-between pb-4">
            <div>
              <h1 class="text-lg font-semibold text-gray-900">{{ section.settings.mobile_menu_label }}</h1>
            </div>
            <div class="-mr-2">
              <button 
                x-on:click="mobileMenuOpen = false"  
                type="button" 
                class="bg-white rounded-md p-2 text-gray-500 hover:bg-gray-100 transition-colors"
              >
                {% render 'icon-x-mark' %}
              </button>
            </div>
          </div>

          <!-- NAVIGATION LINKS FOR MOBILE -->
          <div class="pt-4">
            <nav class="grid gap-y-6">
              {% for link in main_menu_linklist %}
                {% assign link_handle = link.handle | replace: '-', '_' %}
                {% if link.links != blank %}    
                  <div x-data="{ {{link_handle}}: false }" class="relative">
                    <button 
                      x-on:click="{{link_handle}} = !{{link_handle}}" 
                      type="button" 
                      class="text-base font-medium text-gray-700 hover:text-gray-900 flex items-center justify-between w-full transition-colors"
                    >
                      <div>{{ link.title }}</div>
                      {% render 'icon-dropdown' %}
                    </button>
                    <div 
                      x-show="{{link_handle}}" 
                      x-transition
                      class="mt-2 pl-4 border-l-2 border-gray-200"
                    >
                      {% for childlink in link.links %}
                        <div class="py-2">
                          <a 
                            href="{{ childlink.url }}" 
                            class="block p-3 rounded-md text-base font-medium text-gray-600 hover:text-gray-900 hover:bg-gray-50 transition-colors"
                          >
                            {{ childlink.title }}
                          </a>
                        </div>
                      {% endfor %}
                    </div>
                  </div>
                {% else %}
                  <a 
                    href="{{ link.url }}" 
                    class="block p-3 rounded-md text-base font-medium text-gray-700 hover:text-gray-900 hover:bg-gray-50 transition-colors"
                  >
                    {{ link.title }}
                  </a>
                {% endif %}
              {% endfor %}
            </nav>
          </div>

          <!-- MOBILE ACCOUNT & CART -->
          <div class="pt-4 mt-4">
            <div class="flex flex-col space-y-3">
              <a 
                href="{{ routes.account_url }}" 
                class="flex items-center justify-between p-3 rounded-md text-base font-medium text-gray-700 hover:bg-gray-50 transition-colors"
              >
                <span>{% if customer %}Mi cuenta{% else %}Iniciar sesión{% endif %}</span>
                <span class="flex items-center gap-2">
                  {% render 'icon-user' %}
                </span>
              </a>
              <a 
                href="{{ routes.cart_url }}" 
                class="flex items-center justify-between p-3 rounded-md text-base font-medium text-gray-700 hover:bg-gray-50 transition-colors"
              >
                <span>Carrito</span>
                <span class="flex items-center gap-2">
                  {% render 'icon-shopping-bag' %}
                  ({{ cart.item_count }})
                </span>
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
  /* Nav link underline animation */
  .nav-link::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    width: 0;
    height: 2px;
    background-color: #D4A574;
    transition: width 0.3s ease;
  }
  
  .nav-link:hover::after {
    width: 100%;
  }
  
  .nav-link:hover {
    color: #D4A574 !important;
  }
  
  /* Active link - full underline */
  .active-link::after {
    width: 100% !important;
  }
  
  .active-link {
    color: #D4A574 !important;
  }
  
  /* Responsive styles */
  @media (max-width: 768px) {
    .desktop-nav {
      display: none !important;
    }
    .mobile-menu-btn {
      display: block !important;
    }
    .header-row {
      position: relative !important;
    }
    .logo-container {
      position: absolute !important;
      left: 50% !important;
      transform: translateX(-50%) !important;
      margin-right: 0 !important;
    }
  }
  
  @media (min-width: 769px) {
    .mobile-menu-btn {
      display: none !important;
    }
  }
</style>

{%  schema %}
{
  "name": "Header",
  "settings": [
    {
      "type": "image_picker",
      "id": "logo",
      "label": "Logo",
      "info": "Recomendado: PNG con fondo transparente, 200-400px de ancho. Reemplaza el texto 'Home' en la navegación."
    },
    {
      "type": "text",
      "id": "announcement_text",
      "label": "Texto del anuncio superior",
      "default": "Best Special Offers Every Week. 40% Off! Free Delivery Time.",
      "info": "Aparece en la barra verde superior. Déjalo vacío para ocultarla."
    },
    {
      "type": "link_list",
      "id": "menu",
      "label": "Menú de navegación",
      "default": "main-menu"
    },
    {
      "type": "text",
      "id": "mobile_menu_label",
      "label": "Etiqueta del menú móvil",
      "default": "Menú",
      "info": "Este es el título de la ventana del menú móvil."
    }
  ]
}
{% endschema %}